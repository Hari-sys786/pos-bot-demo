<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>POS Management Platform</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
:root {
  --primary: #0066FF; --primary-light: #E8F0FE; --primary-dark: #0052CC;
  --bg: #F0F2F5; --white: #FFFFFF; --text: #1A1A2E; --text-light: #65676B;
  --border: #E4E6EB; --success: #00A854; --danger: #F5222D; --warning: #FAAD14;
}
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f8f9fb; margin: 0; min-height: 100vh; }

/* ‚îÄ‚îÄ Demo Landing Page ‚îÄ‚îÄ */
.landing { max-width: 960px; margin: 0 auto; padding: 60px 24px; }
.landing h1 { font-size: 32px; color: var(--text); margin-bottom: 8px; }
.landing p { font-size: 16px; color: var(--text-light); margin-bottom: 24px; line-height: 1.6; }
.landing .demo-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-top: 32px; }
.landing .demo-card { background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
.landing .demo-card h3 { font-size: 16px; margin-bottom: 6px; color: var(--text); }
.landing .demo-card p { font-size: 13px; color: var(--text-light); margin: 0; }
.landing .demo-card .icon { font-size: 28px; margin-bottom: 12px; }
.landing .hint { margin-top: 40px; padding: 16px 20px; background: var(--primary-light); border-radius: 12px; font-size: 14px; color: var(--primary-dark); }
.landing .hint strong { font-weight: 600; }

/* ‚îÄ‚îÄ Floating Chat Widget ‚îÄ‚îÄ */
.chat-fab {
  position: fixed; bottom: 24px; right: 24px; z-index: 9999;
  width: 60px; height: 60px; border-radius: 50%; border: none;
  background: var(--primary); color: white; font-size: 28px;
  cursor: pointer; box-shadow: 0 4px 16px rgba(0,102,255,0.4);
  display: flex; align-items: center; justify-content: center;
  transition: transform 0.2s, box-shadow 0.2s;
}
.chat-fab:hover { transform: scale(1.08); box-shadow: 0 6px 24px rgba(0,102,255,0.5); }
.chat-fab:active { transform: scale(0.96); }
.chat-fab .badge {
  position: absolute; top: -2px; right: -2px;
  width: 18px; height: 18px; border-radius: 50%;
  background: #F5222D; color: white; font-size: 11px; font-weight: 700;
  display: none; align-items: center; justify-content: center;
}
.chat-fab .badge.show { display: flex; }
.fab-icon-chat, .fab-icon-close { position: absolute; transition: opacity 0.2s, transform 0.2s; }
.chat-fab.open .fab-icon-chat { opacity: 0; transform: rotate(90deg); }
.chat-fab.open .fab-icon-close { opacity: 1; transform: rotate(0deg); }
.chat-fab:not(.open) .fab-icon-close { opacity: 0; transform: rotate(-90deg); }
.chat-fab:not(.open) .fab-icon-chat { opacity: 1; transform: rotate(0deg); }

/* ‚îÄ‚îÄ Chat Popup ‚îÄ‚îÄ */
.chat-popup {
  position: fixed; bottom: 96px; right: 24px; z-index: 9998;
  width: 400px; height: 580px; max-height: calc(100vh - 120px);
  background: var(--white); border-radius: 16px;
  display: flex; flex-direction: column; overflow: hidden;
  box-shadow: 0 12px 48px rgba(0,0,0,0.18);
  opacity: 0; transform: translateY(20px) scale(0.95);
  pointer-events: none; transition: opacity 0.25s ease, transform 0.25s ease;
}
.chat-popup.open {
  opacity: 1; transform: translateY(0) scale(1); pointer-events: auto;
}

.chat-header { background: var(--primary); color: white; padding: 16px 20px; display: flex; align-items: center; gap: 12px; flex-shrink: 0; }
.chat-header .avatar { width: 38px; height: 38px; border-radius: 50%; background: rgba(255,255,255,0.2); display: flex; align-items: center; justify-content: center; font-size: 18px; }
.chat-header .info h3 { font-size: 15px; font-weight: 600; }
.chat-header .info span { font-size: 12px; opacity: 0.85; }
.status-dot { display: inline-block; width: 7px; height: 7px; border-radius: 50%; background: #52C41A; margin-right: 4px; }

.messages { flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 8px; background: var(--bg); scroll-behavior: smooth; }
.messages::-webkit-scrollbar { width: 4px; }
.messages::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }

.msg { display: flex; gap: 8px; max-width: 92%; animation: fadeIn 0.25s ease; }
.msg.bot { align-self: flex-start; }
.msg.user { align-self: flex-end; flex-direction: row-reverse; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

.msg .bubble { padding: 10px 14px; border-radius: 16px; font-size: 14px; line-height: 1.5; box-shadow: 0 1px 2px rgba(0,0,0,0.06); word-break: break-word; }
.msg.bot .bubble { background: var(--white); color: var(--text); border-bottom-left-radius: 4px; }
.msg.user .bubble { background: var(--primary); color: white; border-bottom-right-radius: 4px; }
.msg .bubble strong { font-weight: 600; }
.msg .bubble table { width: 100%; border-collapse: collapse; margin: 8px 0; font-size: 13px; }
.msg .bubble table th { text-align: left; color: var(--text-light); font-weight: 500; padding: 4px 8px; border-bottom: 1px solid var(--border); }
.msg .bubble table td { padding: 4px 8px; border-bottom: 1px solid #f0f0f0; }
.msg.bot .msg-avatar { width: 28px; height: 28px; min-width: 28px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-size: 13px; margin-top: 2px; }

.quick-buttons { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
.quick-btn { padding: 7px 14px; border: 1.5px solid var(--primary); border-radius: 20px; background: var(--white); color: var(--primary); font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.15s; white-space: nowrap; }
.quick-btn:hover { background: var(--primary); color: white; }
.quick-btn:active { transform: scale(0.96); }

.cards-container { display: flex; flex-direction: column; gap: 8px; margin-top: 8px; }
.card { background: #FAFBFC; border: 1px solid var(--border); border-radius: 12px; padding: 12px; transition: box-shadow 0.15s; }
.card:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
.card-title { font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 2px; }
.card-subtitle { font-size: 12px; color: var(--text-light); margin-bottom: 6px; }
.card-fields { font-size: 12.5px; color: var(--text); line-height: 1.6; }
.card-fields strong { font-weight: 600; }
.card-buttons { margin-top: 8px; display: flex; gap: 6px; }
.card-btn { padding: 5px 12px; border: 1px solid var(--primary); border-radius: 16px; background: transparent; color: var(--primary); font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.15s; }
.card-btn:hover { background: var(--primary); color: white; }

.form-card { background: var(--white); border: 1.5px solid var(--primary); border-radius: 14px; padding: 16px; margin-top: 6px; }
.form-card h4 { font-size: 15px; font-weight: 600; color: var(--text); margin-bottom: 12px; }
.form-group { margin-bottom: 10px; }
.form-group label { display: block; font-size: 12px; font-weight: 600; color: var(--text-light); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
.form-group input, .form-group select {
  width: 100%; padding: 9px 12px; border: 1.5px solid var(--border); border-radius: 10px;
  font-size: 14px; background: #FAFBFC; outline: none; transition: border-color 0.15s;
  font-family: inherit; color: var(--text);
}
.form-group input:focus, .form-group select:focus { border-color: var(--primary); background: white; }
.form-group input::placeholder { color: #aaa; }
.form-actions { display: flex; gap: 8px; margin-top: 14px; }
.form-actions button { flex: 1; padding: 10px; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.15s; border: none; }
.form-submit { background: var(--primary); color: white; }
.form-submit:hover { background: var(--primary-dark); }
.form-cancel { background: #f0f0f0; color: var(--text-light); }
.form-cancel:hover { background: #e0e0e0; }

.typing { display: none; align-self: flex-start; padding: 0 8px; }
.typing.show { display: flex; }
.typing .dot-container { background: var(--white); padding: 10px 16px; border-radius: 16px; border-bottom-left-radius: 4px; display: flex; gap: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.06); }
.typing .dot { width: 7px; height: 7px; background: #999; border-radius: 50%; animation: bounce 1.4s infinite; }
.typing .dot:nth-child(2) { animation-delay: 0.2s; }
.typing .dot:nth-child(3) { animation-delay: 0.4s; }
@keyframes bounce { 0%,60%,100% { transform: translateY(0); } 30% { transform: translateY(-6px); } }

.chat-input { padding: 12px 16px; display: flex; gap: 8px; border-top: 1px solid var(--border); background: var(--white); flex-shrink: 0; }
.chat-input input { flex: 1; padding: 10px 16px; border: 1.5px solid var(--border); border-radius: 24px; font-size: 14px; outline: none; transition: border-color 0.15s; }
.chat-input input:focus { border-color: var(--primary); }
.chat-input button { width: 40px; height: 40px; border-radius: 50%; border: none; background: var(--primary); color: white; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
.chat-input button:hover { background: var(--primary-dark); }
.powered-by { text-align: center; padding: 6px; font-size: 11px; color: var(--text-light); background: var(--white); border-top: 1px solid #f0f0f0; }

/* ‚îÄ‚îÄ Mobile ‚îÄ‚îÄ */
@media (max-width: 480px) {
  .chat-popup { width: calc(100vw - 16px); right: 8px; bottom: 88px; height: calc(100vh - 100px); max-height: none; border-radius: 12px; }
  .chat-fab { bottom: 16px; right: 16px; }
}
</style>
</head>
<body>

<!-- Demo Landing Page -->
<div class="landing">
  <h1>üñ•Ô∏è POS Management Platform</h1>
  <p>AI-powered point-of-sale device management, merchant onboarding, real-time alerts, and reporting ‚Äî all in one dashboard.</p>

  <div class="demo-cards">
    <div class="demo-card">
      <div class="icon">üì±</div>
      <h3>Device Management</h3>
      <p>Monitor, add, and manage POS terminals across all locations in real-time.</p>
    </div>
    <div class="demo-card">
      <div class="icon">üè™</div>
      <h3>Merchant Onboarding</h3>
      <p>Streamlined merchant registration with guided step-by-step forms.</p>
    </div>
    <div class="demo-card">
      <div class="icon">üìä</div>
      <h3>Reports & Analytics</h3>
      <p>Daily transaction summaries, regional breakdowns, and performance metrics.</p>
    </div>
    <div class="demo-card">
      <div class="icon">üîî</div>
      <h3>Smart Alerts</h3>
      <p>Proactive notifications for device issues, low battery, and connectivity problems.</p>
    </div>
  </div>

  <div class="hint">
    üëã <strong>Try the AI Assistant!</strong> Click the chat icon in the bottom-right corner to interact with the POS Management Bot.
  </div>
</div>

<!-- Floating Chat Button -->
<button class="chat-fab" id="chatFab" onclick="toggleChat()">
  <span class="fab-icon-chat">üí¨</span>
  <span class="fab-icon-close">‚úï</span>
  <span class="badge" id="badge">1</span>
</button>

<!-- Chat Popup -->
<div class="chat-popup" id="chatPopup">
  <div class="chat-header">
    <div class="avatar">ü§ñ</div>
    <div class="info">
      <h3>POS Assistant</h3>
      <span><span class="status-dot"></span>Online ‚Ä¢ AI Powered</span>
    </div>
  </div>
  <div class="messages" id="messages">
    <div class="typing" id="typing"><div class="dot-container"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>
  </div>
  <div class="chat-input">
    <input type="text" id="input" placeholder="Type a message..." autocomplete="off">
    <button onclick="sendMessage()">‚û§</button>
  </div>
  <div class="powered-by">Powered by AI ‚Ä¢ POS Management Platform</div>
</div>

<script>
const messagesEl = document.getElementById('messages');
const inputEl = document.getElementById('input');
const typingEl = document.getElementById('typing');
const chatFab = document.getElementById('chatFab');
const chatPopup = document.getElementById('chatPopup');
const badge = document.getElementById('badge');
let ws;
let formCounter = 0;
let chatOpen = false;
let connected = false;
let unread = 0;

function toggleChat() {
  chatOpen = !chatOpen;
  chatFab.classList.toggle('open', chatOpen);
  chatPopup.classList.toggle('open', chatOpen);
  if (chatOpen) {
    unread = 0;
    badge.classList.remove('show');
    inputEl.focus();
    scrollBottom();
    if (!connected) connect();
  }
}

function addUnread() {
  if (!chatOpen) {
    unread++;
    badge.textContent = unread;
    badge.classList.add('show');
  }
}

function connect() {
  const proto = location.protocol === 'https:' ? 'wss:' : 'ws:';
  ws = new WebSocket(`${proto}//${location.host}`);
  ws.onerror = (e) => console.error('WS error:', e);
  ws.onopen = () => { console.log('Connected'); connected = true; hideTyping(); };
  ws.onmessage = (e) => {
    hideTyping();
    try {
      const msg = JSON.parse(e.data);
      renderBotMessage(msg);
    } catch { renderBotText(e.data); }
    addUnread();
  };
  ws.onclose = () => { connected = false; setTimeout(connect, 3000); };
}

function sendMessage() {
  const text = inputEl.value.trim();
  if (!text || !ws || ws.readyState !== 1) return;
  renderUserMessage(text);
  ws.send(JSON.stringify({ text }));
  inputEl.value = '';
  showTyping();
}

function sendButton(data, label) {
  renderUserMessage(label);
  ws.send(JSON.stringify({ text: label, button_data: data }));
  showTyping();
}

function submitForm(formId, formElId) {
  const form = document.getElementById(formElId);
  if (!form) return;
  const inputs = form.querySelectorAll('input, select');
  const data = {};
  let valid = true;
  inputs.forEach(inp => {
    if (inp.required && !inp.value.trim()) { inp.style.borderColor = '#F5222D'; valid = false; }
    else { inp.style.borderColor = ''; }
    data[inp.name] = inp.value.trim();
  });
  if (!valid) return;
  const summary = Object.entries(data).map(([k,v]) => `${k}: ${v}`).join(', ');
  renderUserMessage('üìã ' + summary);
  ws.send(JSON.stringify({ text: JSON.stringify(data), button_data: 'form_submit_' + formId }));
  showTyping();
  form.querySelectorAll('input, select, button').forEach(el => el.disabled = true);
  form.style.opacity = '0.6';
}

function cancelForm(formElId) {
  const form = document.getElementById(formElId);
  if (form) { form.style.opacity = '0.4'; form.querySelectorAll('input, select, button').forEach(el => el.disabled = true); }
  sendButton('menu', '‚ùå Cancelled');
}

inputEl.addEventListener('keydown', (e) => { if (e.key === 'Enter') sendMessage(); });

function showTyping() { typingEl.classList.add('show'); scrollBottom(); }
function hideTyping() { typingEl.classList.remove('show'); }
function scrollBottom() { requestAnimationFrame(() => messagesEl.scrollTop = messagesEl.scrollHeight); }

function renderUserMessage(text) {
  const div = document.createElement('div');
  div.className = 'msg user';
  div.innerHTML = '<div class="bubble">' + esc(text) + '</div>';
  messagesEl.insertBefore(div, typingEl);
  scrollBottom();
}

function renderBotMessage(msg) {
  const wrapper = document.createElement('div');
  wrapper.className = 'msg bot';
  let html = '<div class="msg-avatar">ü§ñ</div><div style="flex:1;min-width:0">';

  if (msg.type === 'form') {
    html += renderForm(msg);
  } else if (msg.type === 'cards') {
    html += '<div class="bubble">' + md(msg.content || '');
    html += '<div class="cards-container">';
    for (const card of (msg.cards || [])) {
      html += '<div class="card">';
      html += '<div class="card-title">' + md(card.title || '') + '</div>';
      if (card.subtitle) html += '<div class="card-subtitle">' + esc(card.subtitle) + '</div>';
      if (card.fields) { html += '<div class="card-fields">'; for (const f of card.fields) html += '<div>' + md(f) + '</div>'; html += '</div>'; }
      if (card.buttons) { html += '<div class="card-buttons">'; for (const b of card.buttons) html += '<button class="card-btn" onclick="sendButton(\'' + esc(b.data) + '\',\'' + esc(b.text) + '\')">' + esc(b.text) + '</button>'; html += '</div>'; }
      html += '</div>';
    }
    html += '</div>';
    if (msg.buttons) html += renderButtons(msg.buttons);
    html += '</div>';
  } else {
    html += '<div class="bubble">' + md(msg.content || '');
    if (msg.buttons) html += renderButtons(msg.buttons);
    html += '</div>';
  }

  html += '</div>';
  wrapper.innerHTML = html;
  messagesEl.insertBefore(wrapper, typingEl);
  scrollBottom();
}

function renderForm(msg) {
  formCounter++;
  const fid = 'form_' + formCounter;
  let html = '<div class="form-card" id="' + fid + '">';
  html += '<h4>' + esc(msg.title || 'Form') + '</h4>';
  for (const field of (msg.fields || [])) {
    html += '<div class="form-group">';
    html += '<label>' + esc(field.label) + (field.required ? ' *' : '') + '</label>';
    if (field.type === 'select') {
      html += '<select name="' + esc(field.name) + '"' + (field.required ? ' required' : '') + '>';
      html += '<option value="">‚Äî Select ‚Äî</option>';
      for (const opt of (field.options || [])) {
        html += '<option value="' + esc(opt.value) + '">' + esc(opt.label) + '</option>';
      }
      html += '</select>';
    } else {
      html += '<input type="' + (field.type || 'text') + '" name="' + esc(field.name) + '" placeholder="' + esc(field.placeholder || '') + '"' + (field.required ? ' required' : '') + '>';
    }
    html += '</div>';
  }
  html += '<div class="form-actions">';
  html += '<button class="form-cancel" onclick="cancelForm(\'' + fid + '\')">Cancel</button>';
  html += '<button class="form-submit" onclick="submitForm(\'' + esc(msg.form_id) + '\',\'' + fid + '\')">Submit</button>';
  html += '</div></div>';
  return html;
}

function renderBotText(text) { renderBotMessage({ type: 'text', content: text }); }

function renderButtons(buttons) {
  let html = '<div class="quick-buttons">';
  for (const b of buttons) html += '<button class="quick-btn" onclick="sendButton(\'' + esc(b.data) + '\',\'' + esc(b.text) + '\')">' + esc(b.text) + '</button>';
  return html + '</div>';
}

function esc(s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
}

function md(s) {
  s = esc(s);
  s = s.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
  if (s.includes('|')) {
    const lines = s.split('\n');
    let inTable = false, result = [], tableHtml = '', headerDone = false;
    for (const line of lines) {
      if (line.trim().startsWith('|') && line.trim().endsWith('|')) {
        if (!inTable) { inTable = true; tableHtml = '<table>'; headerDone = false; }
        const cells = line.split('|').filter(c => c.trim()).map(c => c.trim());
        if (cells.every(c => /^[-:]+$/.test(c))) { headerDone = true; continue; }
        const tag = !headerDone ? 'th' : 'td';
        tableHtml += '<tr>' + cells.map(c => '<' + tag + '>' + c + '</' + tag + '>').join('') + '</tr>';
      } else {
        if (inTable) { result.push(tableHtml + '</table>'); inTable = false; }
        result.push(line);
      }
    }
    if (inTable) result.push(tableHtml + '</table>');
    s = result.join('\n');
  }
  s = s.replace(/\n/g, '<br>');
  s = s.replace(/&amp;nbsp;/g, '&nbsp;');
  return s;
}

// Auto-connect on load (lazy ‚Äî connects when chat opens)
// Show badge hint after 2 seconds
setTimeout(() => { if (!chatOpen) { badge.textContent = '1'; badge.classList.add('show'); } }, 2000);
</script>
</body>
</html>
